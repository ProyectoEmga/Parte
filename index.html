<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Parte Dpto. Finanzas y Abastecimiento EMGA 2025</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@400;500&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f4f8;
        }
        .header-armada {
            background-color: #003366;
            color: #ffffff;
            padding: 1.5rem;
            text-align: center;
            border-bottom: 5px solid #ffcc00;
            position: relative;
        }
        .header-armada .last-updated {
            position: absolute;
            bottom: 0.5rem;
            right: 1rem;
            font-size: 0.8rem;
            color: rgba(255, 255, 255, 0.7);
        }
        .container-armada {
            background-color: #ffffff;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            padding: 2rem;
            margin: 2rem auto;
            width: 95%;
            max-width: 1024px;
        }
        .personnel-grid-section {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
            padding-bottom: 1rem;
        }
        .person-card {
            background-color: #e0e7ff;
            border: 1px solid #a7baff;
            border-radius: 0.5rem;
            padding: 0.75rem;
            position: relative;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            transition: transform 0.1s ease-in-out, box-shadow 0.1s ease-in-out;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            min-height: 100px;
        }
        .person-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        .person-card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
        }
        .person-card-name {
            font-weight: bold;
            color: #003366;
            line-height: 1.2;
            flex-grow: 1;
            font-size: 0.95rem;
        }
        .person-card-status-text {
            font-size: 0.75rem;
            color: #4a5568;
            background-color: #c3daff;
            padding: 0.2rem 0.4rem;
            border-radius: 0.25rem;
            margin-top: auto;
            text-align: center;
        }
        .remove-card-btn {
            position: absolute;
            top: 5px; right: 5px; background-color: #dc3545; color: white;
            border: none; border-radius: 50%; width: 20px; height: 20px;
            font-size: 0.7rem; display: flex; align-items: center; justify-content: center;
            cursor: pointer; opacity: 0.8; transition: opacity 0.2s;
        }
        .remove-card-btn:hover { opacity: 1; }
        .status-switch {
            width: 60px; height: 28px; background-color: #6c757d; border-radius: 14px;
            position: relative; cursor: pointer; transition: background-color 0.3s ease;
            flex-shrink: 0; margin-left: 0.5rem; display: flex; align-items: center;
            padding: 2px; box-shadow: inset 0 1px 3px rgba(0,0,0,0.2);
        }
        .switch-handle {
            width: 24px; height: 24px; background-color: white; border-radius: 50%;
            position: absolute; transition: transform 0.3s ease;
            box-shadow: 0 1px 3px rgba(0,0,0,0.2);
        }
        .status-switch[data-state="green"] { background-color: #28a745; }
        .status-switch[data-state="green"] .switch-handle { transform: translateX(32px); }
        .status-switch[data-state="red"] { background-color: #dc3545; }
        .status-switch[data-state="red"] .switch-handle { transform: translateX(16px); }
        .status-switch[data-state="gray"] { background-color: #6c757d; }
        .status-switch[data-state="gray"] .switch-handle { transform: translateX(0); }

        .popover-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-color: rgba(0, 0, 0, 0.4); display: flex; justify-content: center;
            align-items: center; z-index: 1000; opacity: 0; visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }
        .popover-overlay.visible { opacity: 1; visibility: visible; }
        .popover-content {
            background-color: #ffffff; padding: 1.5rem; border-radius: 8px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3); max-width: 90%; width: 380px;
            transform: translateY(-20px); opacity: 0;
            transition: transform 0.3s ease, opacity 0.3s ease;
        }
        .popover-overlay.visible .popover-content { transform: translateY(0); opacity: 1; }
        .popover-content h4 { font-size: 1.25rem; font-weight: bold; margin-bottom: 1rem; color: #003366; text-align: center; }
        .popover-content .form-group { margin-bottom: 1rem; }
        .popover-content label { display: block; margin-bottom: 0.5rem; font-weight: 500; color: #4a5568; }
        .popover-content select, .popover-content input {
            width: 100%; padding: 0.75rem; border: 1px solid #cbd5e0; border-radius: 0.375rem; font-size: 1rem;
        }
        .popover-content .button-group { display: flex; justify-content: flex-end; gap: 0.75rem; margin-top: 1.5rem;}
        #popover-detail-group { display: none; }

        .summary-box { background-color: #e6f0f9; border: 1px solid #b3d1f1; border-radius: 8px; padding: 1.5rem; margin-top: 2rem; }
        .summary-detail-list { list-style-position: inside; padding-left: 1.5rem; font-size: 0.9rem; color: #4a5568; }

        /* Styles for the image summary (corrected for reliable capture) */
        #summary-for-image-wrapper {
            position: absolute;
            top: 0;
            left: 0;
            height: 1px;
            width: 1px;
            overflow: hidden;
            opacity: 0;
        }
        #summary-for-image {
            width: 800px;
            background: white;
            padding: 20px;
            font-family: 'Roboto Mono', monospace;
            color: #000;
        }
        .img-summary-container {
            border: 4px solid #003366;
            padding: 15px;
        }
        .img-summary-title {
            background-color: #003366;
            color: white;
            padding: 8px;
            text-align: center;
            font-weight: bold;
            font-size: 1.2rem;
            margin-bottom: 15px;
        }
        .img-summary-row {
            display: flex;
            align-items: stretch;
            margin-bottom: 5px;
        }
        .img-summary-label {
            width: 200px;
            padding: 8px;
            font-weight: 500;
            flex-shrink: 0;
        }
        .img-summary-box {
            border: 2px solid #003366;
            padding: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            min-height: 38px;
            width: 100px;
        }
        .img-summary-con-motivo {
            display: flex;
            flex-direction: column;
            width: 100%;
        }
        .img-summary-con-motivo .img-summary-row {
            position: relative;
            margin-left: 40px;
        }
        /* Creating the connector lines */
        .img-summary-row.con-motivo-main > .img-summary-label::after {
            content: '';
            position: absolute;
            left: 200px;
            top: 50%;
            width: 20px;
            height: 2px;
            background-color: #003366;
        }
        .img-summary-con-motivo .img-summary-row::before {
            content: '';
            position: absolute;
            left: -20px;
            top: -50%;
            bottom: 50%;
            width: 2px;
            background-color: #003366;
        }
        .img-summary-con-motivo .img-summary-row:first-child::before {
            top: 50%;
        }
         .img-summary-con-motivo .img-summary-row:last-child::before {
            bottom: 50%;
        }
        .img-summary-con-motivo .img-summary-row::after {
            content: '';
            position: absolute;
            left: -20px;
            top: 50%;
            width: 20px;
            height: 2px;
            background-color: #003366;
        }
        .img-summary-details-box {
            border: 2px solid #003366;
            padding: 8px;
            flex-grow: 1;
            margin-left: 5px;
            min-height: 38px;
        }
        .img-summary-details-box ul {
            margin: 0;
            padding: 0;
            list-style: none;
        }
    </style>
</head>
<body class="min-h-screen flex flex-col items-center">
    <header class="header-armada w-full no-capture">
        <h1 class="text-3xl font-bold">Parte Dpto. Finanzas y Abastecimiento EMGA 2025</h1>
        <div class="last-updated" id="last-updated"></div>
    </header>

    <div class="container-armada">
        <div class="no-capture">
            <h2 class="text-2xl font-semibold mb-2 text-gray-800">Estado del Personal</h2>
            <h3 class="text-xl font-semibold mt-4 mb-2 text-gray-700 border-b pb-2">FINANZAS</h3>
            <div id="finanzas-grid" class="personnel-grid-section"></div>
            <h3 class="text-xl font-semibold mt-6 mb-2 text-gray-700 border-b pb-2">STAFF</h3>
            <div id="staff-grid" class="personnel-grid-section"></div>
            <div class="add-person-section mt-8 pt-6 border-t">
                <input type="text" id="new-person-name" placeholder="Ingrese nuevo nombre de persona" class="flex-grow p-2 border rounded">
                <button type="button" id="add-person-btn" class="bg-blue-800 text-white font-bold py-2 px-4 rounded hover:bg-blue-900 transition-colors">Agregar Persona</button>
            </div>
        </div>

        <div class="summary-box" id="summary-box-on-screen">
             <h3 class="text-xl font-semibold mb-4 text-gray-800 text-center">Resumen General</h3>
             <div id="overall-summary-display"></div>
        </div>
        <button type="button" id="download-summary-btn" class="mt-6 w-full bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-4 rounded transition-colors no-capture">Descargar Resumen como Imagen</button>
    </div>

    <!-- Popover for editing status -->
    <div class="popover-overlay no-capture" id="edit-status-popover">
        <div class="popover-content relative">
            <button id="popover-close-btn" class="absolute top-2 right-4 text-2xl font-bold text-gray-500 hover:text-gray-800">&times;</button>
            <h4 id="popover-person-name"></h4>
            <div class="form-group">
                <label for="popover-status-select">Seleccione motivo:</label>
                <select id="popover-status-select"></select>
            </div>
            <div class="form-group" id="popover-detail-group">
                <label for="popover-detail-input">Detalle:</label>
                <input type="text" id="popover-detail-input" placeholder="Ej: Comisión a Valparaíso">
            </div>
            <div class="button-group">
                <button id="popover-cancel-btn" class="bg-gray-200 hover:bg-gray-300 font-bold py-2 px-4 rounded">Cancelar</button>
                <button id="popover-save-btn" class="bg-blue-800 hover:bg-blue-900 text-white font-bold py-2 px-4 rounded">Guardar</button>
            </div>
        </div>
    </div>
    
    <!-- Hidden wrapper for generating the image -->
    <div id="summary-for-image-wrapper">
        <div id="summary-for-image"></div>
    </div>


    <script defer>
        document.addEventListener('DOMContentLoaded', () => {
            const ui = {
                finanzasGrid: document.getElementById('finanzas-grid'),
                staffGrid: document.getElementById('staff-grid'),
                addPersonBtn: document.getElementById('add-person-btn'),
                newPersonNameInput: document.getElementById('new-person-name'),
                lastUpdatedElement: document.getElementById('last-updated'),
                downloadSummaryBtn: document.getElementById('download-summary-btn'),
                overallSummaryDisplay: document.getElementById('overall-summary-display'),
                popover: document.getElementById('edit-status-popover'),
                popoverCloseBtn: document.getElementById('popover-close-btn'),
                popoverCancelBtn: document.getElementById('popover-cancel-btn'),
                popoverSaveBtn: document.getElementById('popover-save-btn'),
                popoverPersonName: document.getElementById('popover-person-name'),
                popoverStatusSelect: document.getElementById('popover-status-select'),
                popoverDetailGroup: document.getElementById('popover-detail-group'),
                popoverDetailInput: document.getElementById('popover-detail-input'),
                summaryForImage: document.getElementById('summary-for-image'),
            };

            const config = {
                personnelDataKey: 'personnelDataEmga2025-v5',
                lastUpdatedKey: 'lastUpdatedEmga2025-v5',
                finanzasNames: ['T1 ANDRÉS VARAS', 'PAC RAÚL DÍAZ', 'SO GERMÁN CASTRO', 'SO JUAN MUÑOZ', 'S1 CARLOS ALARCÓN', 'S1 JORGE ESPINOZA', 'S1 CARLOS JIMÉNEZ', 'S2 GABRIEL CLAVERÍA', 'C1 JONATAN MORAGA', 'C1 SAMI DONOSO', 'TT PEDRO VERDUGO'],
                staffNames: ['SO RICARDO CARIPÁN', 'SO ALFONSO ESPINOZA', 'S1 ROBERTO ALEGRÍA', 'S1 MARCO ERAZO', 'S2 JOSUÉ RAÍN'],
                categories: [
                    { value: 'A bordo', text: 'A bordo', type: 'green' },
                    { value: 'Sin motivo', text: 'Sin motivo', type: 'gray' },
                    { value: 'En comisión', text: 'Comisión', type: 'red', needsDetail: true },
                    { value: 'En trabajos', text: 'Trabajos', type: 'red', needsDetail: true },
                    { value: 'Baja médica', text: 'Baja médica', type: 'red' },
                    { value: 'Con permiso', text: 'Permiso', type: 'red' },
                    { value: 'Alto mando', text: 'Alto mando', type: 'red' },
                ],
                greenStatus: 'A bordo',
                grayStatus: 'Sin motivo',
            };
            config.redCategories = config.categories.filter(c => c.type === 'red');
            config.initialPersonnelNames = [...config.finanzasNames, ...config.staffNames];

            let state = {
                personnel: [],
                currentEditingPersonId: null,
            };

            const generateId = () => Date.now().toString(36) + Math.random().toString(36).substring(2, 5);

            const saveState = () => {
                try {
                    localStorage.setItem(config.personnelDataKey, JSON.stringify(state.personnel));
                    updateLastUpdatedTime();
                } catch (e) { console.warn('Could not save state:', e); }
            };

            const loadState = () => {
                try {
                    const storedData = localStorage.getItem(config.personnelDataKey);
                    let loadedData = storedData ? JSON.parse(storedData) : [];
                    const loadedMap = new Map(loadedData.map(p => [p.name, p]));
                    
                    const personnelList = config.initialPersonnelNames.map(name => {
                        if (loadedMap.has(name)) {
                            const person = loadedMap.get(name);
                            loadedMap.delete(name);
                            return { detail: '', ...person };
                        }
                        return { id: generateId(), name, status: config.greenStatus, detail: '' };
                    });
                    
                    state.personnel = [...personnelList, ...Array.from(loadedMap.values())];

                } catch (e) {
                    console.warn('Error loading state:', e);
                    state.personnel = config.initialPersonnelNames.map(name => ({ id: generateId(), name, status: config.greenStatus, detail: '' }));
                }
                render();
            };

            const updateLastUpdatedTime = () => {
                const now = new Date();
                const options = { year: 'numeric', month: 'long', day: 'numeric', hour: '2-digit', minute: '2-digit', timeZone: 'America/Santiago' };
                try {
                    const formattedDate = new Intl.DateTimeFormat('es-CL', options).format(now);
                    const fullText = `Última actualización: ${formattedDate}`;
                    ui.lastUpdatedElement.textContent = fullText;
                    localStorage.setItem(config.lastUpdatedKey, fullText);
                } catch (e) {
                    ui.lastUpdatedElement.textContent = `Última actualización: ${now.toLocaleString()}`;
                }
            };
            
            const createPersonCard = (person) => {
                const card = document.createElement('div');
                card.className = 'person-card';
                card.innerHTML = `
                    <button class="remove-card-btn">&times;</button>
                    <div class="person-card-header">
                        <div class="person-card-name">${person.name}</div>
                        <div class="status-switch" data-state="${config.categories.find(c=>c.value === person.status)?.type || 'gray'}">
                            <div class="switch-handle"></div>
                        </div>
                    </div>
                    <div class="person-card-status-text">${person.status}</div>
                `;
                card.querySelector('.remove-card-btn').onclick = (e) => { e.stopPropagation(); removePerson(person.id); };
                card.querySelector('.status-switch').onclick = (e) => { e.stopPropagation(); toggleSwitchState(person.id); };
                return card;
            };

            const toggleSwitchState = (personId) => {
                const person = state.personnel.find(p => p.id === personId);
                if (!person) return;
                const currentStatusType = config.categories.find(c => c.value === person.status)?.type;
                if (currentStatusType === 'green') openEditPopover(person);
                else if (currentStatusType === 'red') person.status = config.grayStatus;
                else person.status = config.greenStatus;
                saveState();
                render();
            };

            const addPerson = () => {
                const name = ui.newPersonNameInput.value.trim().toUpperCase();
                if (!name) return;
                if (state.personnel.some(p => p.name.toLowerCase() === name.toLowerCase())) {
                    alert('Esta persona ya existe.');
                    return;
                }
                state.personnel.push({ id: generateId(), name, status: config.greenStatus, detail: '' });
                ui.newPersonNameInput.value = '';
                saveState();
                render();
            };
            
            const removePerson = (id) => {
                if (confirm('¿Está seguro de que desea eliminar a esta persona?')) {
                    state.personnel = state.personnel.filter(p => p.id !== id);
                    saveState();
                    render();
                }
            };
            
            const openEditPopover = (person) => {
                state.currentEditingPersonId = person.id;
                ui.popoverPersonName.textContent = person.name;
                ui.popoverStatusSelect.innerHTML = config.redCategories.map(c => `<option value="${c.value}">${c.text}</option>`).join('');
                ui.popoverStatusSelect.value = person.status !== config.greenStatus ? person.status : config.redCategories[0].value;
                ui.popoverDetailInput.value = person.detail || '';
                handlePopoverDetailVisibility();
                ui.popover.classList.add('visible');
            };

            const closeEditPopover = () => ui.popover.classList.remove('visible');

            const handlePopoverDetailVisibility = () => {
                const selectedStatus = ui.popoverStatusSelect.value;
                const needsDetail = config.categories.find(c => c.value === selectedStatus)?.needsDetail;
                ui.popoverDetailGroup.style.display = needsDetail ? 'block' : 'none';
            };

            const savePopoverChanges = () => {
                const person = state.personnel.find(p => p.id === state.currentEditingPersonId);
                if (person) {
                    person.status = ui.popoverStatusSelect.value;
                    const needsDetail = config.categories.find(c => c.value === person.status)?.needsDetail;
                    person.detail = needsDetail ? ui.popoverDetailInput.value : '';
                    saveState();
                    render();
                }
                closeEditPopover();
            };

            const getSummaryData = () => {
                const data = {
                    fuerzaEfectiva: state.personnel.length,
                    forman: 0,
                    conMotivo: 0,
                    personalStaffConMotivo: 0,
                    byCategory: {}
                };

                config.redCategories.forEach(c => data.byCategory[c.value] = []);

                state.personnel.forEach(p => {
                    if (p.status === config.greenStatus) data.forman++;
                    else if (config.redCategories.some(c => c.value === p.status)) {
                        data.conMotivo++;
                        data.byCategory[p.status].push(p);
                        if(config.staffNames.includes(p.name)) {
                            data.personalStaffConMotivo++;
                        }
                    }
                });
                return data;
            };

            const updateOnScreenSummary = (data) => {
                let html = `<div class="grid grid-cols-2 gap-x-4 gap-y-2">`;
                html += `<div class="font-bold text-gray-700">Fuerza Efectiva:</div><div class="text-right font-semibold">${data.fuerzaEfectiva}</div>`;
                html += `<div class="font-bold text-gray-700">Forman:</div><div class="text-right font-semibold">${data.forman}</div>`;
                html += `<div class="font-bold text-gray-700 col-span-2 border-b pb-1 mb-1">Con Motivo: <span class="float-right font-semibold">${data.conMotivo}</span></div>`;

                config.redCategories.forEach(c => {
                     const people = data.byCategory[c.value] || [];
                     const count = people.length;
                     if(count > 0) {
                         html += `<div class="font-semibold text-gray-600 col-span-2">${c.text}: <span class="float-right font-normal">${count}</span></div>`;
                         html += `<div class="col-span-2"><ul class="summary-detail-list">`;
                         people.forEach(p => {
                            html += `<li>${p.name}${p.detail ? ` (${p.detail})` : ''}</li>`;
                         });
                         html += `</ul></div>`;
                     }
                });
                html += `</div>`;
                ui.overallSummaryDisplay.innerHTML = html;
            };
            
            const prepareImageSummary = (data) => {
                const detailsHTML = (categoryValue) => {
                    const people = data.byCategory[categoryValue];
                    if (!people || people.length === 0) return '<ul><li>N/A</li></ul>';
                    return `<ul>${people.map(p => `<li>${p.name}${p.detail ? ` (${p.detail})` : ''}</li>`).join('')}</ul>`;
                };

                const html = `
                    <div class="img-summary-container">
                        <div class="img-summary-title">PARTE DEPTO. FINANZAS E.M.G.A</div>
                        <div class="img-summary-row">
                            <div class="img-summary-label">Fuerza Efectiva</div>
                            <div class="img-summary-box">${data.fuerzaEfectiva}</div>
                        </div>
                        <div class="img-summary-row">
                            <div class="img-summary-label">Forman</div>
                            <div class="img-summary-box">${data.forman}</div>
                        </div>
                        <div class="img-summary-row con-motivo-main">
                            <div class="img-summary-label">Con Motivo</div>
                            <div class="img-summary-box">${data.conMotivo}</div>
                            <div class="img-summary-con-motivo">
                                <div class="img-summary-row">
                                    <div class="img-summary-label">Personal staff</div>
                                    <div class="img-summary-box">${data.personalStaffConMotivo}</div>
                                </div>
                                <div class="img-summary-row">
                                    <div class="img-summary-label">Baja médica</div>
                                    <div class="img-summary-box">${data.byCategory['Baja médica']?.length || 0}</div>
                                </div>
                                <div class="img-summary-row">
                                    <div class="img-summary-label">Permiso</div>
                                    <div class="img-summary-box">${data.byCategory['Con permiso']?.length || 0}</div>
                                </div>
                                <div class="img-summary-row">
                                    <div class="img-summary-label">Trabajos</div>
                                    <div class="img-summary-details-box">${detailsHTML('En trabajos')}</div>
                                </div>
                                <div class="img-summary-row">
                                    <div class="img-summary-label">Comisión</div>
                                    <div class="img-summary-details-box">${detailsHTML('En comisión')}</div>
                                </div>
                            </div>
                        </div>
                    </div>`;
                ui.summaryForImage.innerHTML = html;
            };

            const downloadSummaryAsImage = () => {
                const data = getSummaryData();
                prepareImageSummary(data);
                
                setTimeout(() => {
                    html2canvas(document.getElementById('summary-for-image'), { scale: 2.5, logging: false, useCORS: true })
                        .then(canvas => {
                            const link = document.createElement('a');
                            link.download = `Resumen_Personal_EMGA_${new Date().toLocaleDateString('es-CL').replace(/\//g, '-')}.png`;
                            link.href = canvas.toDataURL('image/png');
                            document.body.appendChild(link);
                            link.click();
                            document.body.removeChild(link);
                        })
                        .catch(error => {
                            console.error('Error al generar la imagen:', error);
                            alert('Hubo un error al generar la imagen del resumen.');
                        });
                }, 100);
            };

            const render = () => {
                ui.finanzasGrid.innerHTML = '';
                ui.staffGrid.innerHTML = '';
                state.personnel.forEach(person => {
                    const card = createPersonCard(person);
                    if (config.finanzasNames.includes(person.name)) ui.finanzasGrid.appendChild(card);
                    else if (config.staffNames.includes(person.name)) ui.staffGrid.appendChild(card);
                    else ui.finanzasGrid.appendChild(card);
                });
                const summaryData = getSummaryData();
                updateOnScreenSummary(summaryData);
            };
            
            // Event Listeners
            ui.addPersonBtn.addEventListener('click', addPerson);
            ui.newPersonNameInput.addEventListener('keypress', e => e.key === 'Enter' && addPerson());
            ui.downloadSummaryBtn.addEventListener('click', downloadSummaryAsImage);
            ui.popoverCloseBtn.addEventListener('click', closeEditPopover);
            ui.popoverCancelBtn.addEventListener('click', closeEditPopover);
            ui.popoverSaveBtn.addEventListener('click', savePopoverChanges);
            ui.popoverStatusSelect.addEventListener('change', handlePopoverDetailVisibility);
            
            // Initialization
            loadState();
            updateLastUpdatedTime();
            setInterval(updateLastUpdatedTime, 60000);
        });
    </script>
</body>
</html>
